# syntax=docker/dockerfile:1

# build the nest application for production
FROM    node:alpine

ARG RUNNING_ENV=${RUNNING_ENV}
ARG SERVER_PORT=${SERVER_PORT}
ARG CLIENT_PORT=${CLIENT_PORT}
ARG DBADMIN_PORT=${DBADMIN_PORT}
ARG POSTGRES_USER=${POSTGRES_USER}
ARG POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
ARG POSTGRES_DB=${POSTGRES_DB}
ARG PGDATA=${PGDATA}
ARG POSTGRES_PORT=${POSTGRES_PORT}
ARG API_PORT=${API_PORT}
ARG REACT_APP_API_URL=${REACT_APP_API_URL}
ARG GAME_WS_PORT=${GAME_WS_PORT}
ARG REACT_APP_GAME_SOCKET_URL=${REACT_APP_GAME_SOCKET_URL}
ARG CHAT_WS_PORT=${CHAT_WS_PORT}
ARG REACT_APP_CHAT_SOCKET_URL=${REACT_APP_CHAT_SOCKET_URL}
ARG CLIENT_ID=${CLIENT_ID}
ARG CLIENT_SECRET=${CLIENT_SECRET}
ARG CALLBACK_URL=${CALLBACK_URL}
ARG SESSION_SECRET=${SESSION_SECRET}
ARG REDIS_URL=${REDIS_URL}
ARG REDIS_PORT=${REDIS_PORT}
ARG REDIS_INSIGHT_PORT=${REDIS_INSIGHT_PORT}
ARG DATABASE_URL=${DATABASE_URL}
ARG WEBSITE_URL=${WEBSITE_URL}
ARG HOME_PAGE=${HOME_PAGE}
ARG LOGIN_PAGE=${LOGIN_PAGE}
ARG TWO_FA_APP_NAME=${TWO_FA_APP_NAME}

WORKDIR /app

COPY    .   /app/

# install dependencies
RUN     npm i -g npm@8.18.0 \
 &&     npm i

CMD     ["sh"]
